"use strict";var _=Object.create;var x=Object.defineProperty;var Y=Object.getOwnPropertyDescriptor;var Z=Object.getOwnPropertyNames;var K=Object.getPrototypeOf,V=Object.prototype.hasOwnProperty;var j=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),z=(e,t)=>{for(var r in t)x(e,r,{get:t[r],enumerable:!0})},q=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Z(t))!V.call(e,o)&&o!==r&&x(e,o,{get:()=>t[o],enumerable:!(n=Y(t,o))||n.enumerable});return e};var c=(e,t,r)=>(r=e!=null?_(K(e)):{},q(t||!e||!e.__esModule?x(r,"default",{value:e,enumerable:!0}):r,e)),H=e=>q(x({},"__esModule",{value:!0}),e);var u=j((ue,B)=>{var i=B.exports={},p,f;function R(){throw new Error("setTimeout has not been defined")}function Q(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?p=setTimeout:p=R}catch{p=R}try{typeof clearTimeout=="function"?f=clearTimeout:f=Q}catch{f=Q}})();function D(e){if(p===setTimeout)return setTimeout(e,0);if((p===R||!p)&&setTimeout)return p=setTimeout,setTimeout(e,0);try{return p(e,0)}catch{try{return p.call(null,e,0)}catch{return p.call(this,e,0)}}}function X(e){if(f===clearTimeout)return clearTimeout(e);if((f===Q||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(e);try{return f(e)}catch{try{return f.call(null,e)}catch{return f.call(this,e)}}}var d=[],v=!1,w,b=-1;function ee(){!v||!w||(v=!1,w.length?d=w.concat(d):b=-1,d.length&&E())}function E(){if(!v){var e=D(ee);v=!0;for(var t=d.length;t;){for(w=d,d=[];++b<t;)w&&w[b].run();b=-1,t=d.length}w=null,v=!1,X(e)}}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];d.push(new L(e,t)),d.length===1&&!v&&D(E)};function L(e,t){this.fun=e,this.array=t}L.prototype.run=function(){this.fun.apply(null,this.array)};i.title="browser";i.browser=!0;i.env={};i.argv=[];i.version="";i.versions={};function m(){}i.on=m;i.addListener=m;i.once=m;i.off=m;i.removeListener=m;i.removeAllListeners=m;i.emit=m;i.prependListener=m;i.prependOnceListener=m;i.listeners=function(e){return[]};i.binding=function(e){throw new Error("process.binding is not supported")};i.cwd=function(){return"/"};i.chdir=function(e){throw new Error("process.chdir is not supported")};i.umask=function(){return 0}});var ae={};z(ae,{init:()=>ie});module.exports=H(ae);var Ie=c(u(),1);var ye=c(u(),1);var ce=c(u(),1),$="https://arweave.net",T={profileSrc:"_R2XYWDPUXVvQrQKFaQRvDTDcDwnQNbqlTd_qvCRSpQ",module:"Pq2Zftrqut0hdisH_MC2pDOT6S4eQFoxGsFUzR6r350",scheduler:"_GQ33BkPtZrqxA84vM8Zk-N2aO0toNNu_C-l-rawrBA",profileRegistry:"SNy4m-DrqxWl01YqGM4sxI8qCni-58re8uuJLvZPypY"},A={arweave:"https://arweave.net",goldsky:"https://arweave-search.goldsky.com"},C={default:100,landing:{assets:30},collection:{assets:15},profile:{assets:15}},G={p1:"P1",end:"END"};function te(e){let t=e.paginator?e.paginator:C.default,r=e.ids?JSON.stringify(e.ids):null,n=null;e.minBlock!==void 0&&e.minBlock!==null&&(n={},n.min=e.minBlock);let o=n?JSON.stringify(n).replace(/"([^"]+)":/g,"$1:"):null,s=e.tagFilters?JSON.stringify(e.tagFilters).replace(/"(name)":/g,"$1:").replace(/"(values)":/g,"$1:").replace(/"FUZZY_OR"/g,"FUZZY_OR"):null,a=e.owners?JSON.stringify(e.owners):null,l=e.cursor&&e.cursor!==G.end?`"${e.cursor}"`:null,h=`first: ${t}`,y="",P="data { size type } owner { address } block { height timestamp }",I="";switch(e.gateway){case A.arweave:break;case A.goldsky:y="count";break}let g=`
		transactions(
				ids: ${r},
				tags: ${s},
				${h}
				owners: ${a},
				block: ${o},
				after: ${l},
				${I}
				
			){
			${y}
				pageInfo {
					hasNextPage
				}
				edges {
					cursor
					node {
						id
						tags {
							name 
							value 
						}
						${P}
					}
				}
		}`;return e.queryKey&&(g=`${e.queryKey}: ${g}`),g}async function re(e){try{return await(await fetch(`${e.gateway}/graphql`,{method:"POST",headers:{"Content-Type":"application/json"},body:e.query})).json()}catch(t){throw t}}function ne(e){let t={query:`query { ${e} }`};return JSON.stringify(t)}async function k(e){let t=e.paginator?e.paginator:C.default,r=[],n=0,o=null;if(e.ids&&!e.ids.length)return{data:r,count:n,nextCursor:o,previousCursor:null};try{let s=te(e),a=await re({gateway:e.gateway,query:ne(s)});return a.data.transactions.edges.length?(r=[...a.data.transactions.edges],n=a.data.transactions.count??0,r.length<t||!a.data.transactions.pageInfo.hasNextPage?o=G.end:o=r[r.length-1].cursor,{data:r,count:n,nextCursor:o,previousCursor:null}):{data:r,count:n,nextCursor:o,previousCursor:null}}catch(s){return console.error(s),{data:r,count:n,nextCursor:o,previousCursor:null}}}function O(e,t){for(let r=0;r<e.length;r++)if(e[r]&&e[r].name===t)return e[r].value;return null}async function U(e){try{let t=[{name:"Action",value:e.action}];e.tags&&t.push(...e.tags);let r=e.data,n=await e.ao.message({process:e.processId,signer:e.signer,tags:t,data:r}),{Messages:o}=await e.ao.result({message:n,process:e.processId});if(o&&o.length){let s={};return o.forEach(a=>{let l=O(a.Tags,"Action")||e.action,h=null,y=a.Data;if(y)try{h=JSON.parse(y)}catch{h=y}let P=O(a.Tags,"Status"),I=O(a.Tags,"Message");s[l]={id:n,status:P,message:I,data:h}}),s}else return null}catch(t){console.error(t)}}function S(e){return Object.fromEntries(Object.entries(e).map(([t,r])=>[t.charAt(0).toUpperCase()+t.slice(1),r]))}var he=c(u(),1);async function N(e){let t=[{name:"Action",value:e.action}];e.tags&&t.push(...e.tags);let r=JSON.stringify(e.data||{}),n=await e.ao.dryrun({process:e.processId,tags:t,data:r});if(n.Messages&&n.Messages.length){if(n.Messages[0].Data)return JSON.parse(n.Messages[0].Data);if(n.Messages[0].Tags)return n.Messages[0].Tags.reduce((o,s)=>(o[s.name]=s.value,o),{})}}function F(e){return async t=>{let r={id:t.profileId,walletAddress:null,displayName:null,username:null,bio:null,avatar:null,banner:null,version:null};try{let n=await N({processId:t.profileId,action:"Info",data:null,ao:e.ao});return n?{id:t.profileId,walletAddress:n.Owner||null,displayName:n.Profile.DisplayName||null,username:n.Profile.UserName||null,bio:n.Profile.Description||null,avatar:n.Profile.ProfileImage||null,banner:n.Profile.CoverImage||null,version:n.Profile.Version||null,assets:n.Assets?.map(o=>o.Id)??[]}:r}catch(n){throw new Error(n)}}}function W(e){return async t=>{let r={id:null,walletAddress:t.address,displayName:null,username:null,bio:null,avatar:null,banner:null,version:null};try{let n=await N({processId:e.registry?e.registry:T.profileRegistry,action:"Get-Profiles-By-Delegate",data:{Address:t.address},ao:e.ao}),o=null;if(n&&n.length>0&&n[0].ProfileId&&(o=n[0].ProfileId),o){let s=await N({processId:o,action:"Info",data:null,ao:e.ao});return s?{id:o,walletAddress:s.Owner||null,displayName:s.Profile.DisplayName||null,username:s.Profile.UserName||null,bio:s.Profile.Description||null,avatar:s.Profile.ProfileImage||null,banner:s.Profile.CoverImage||null,version:s.Profile.Version||null,assets:s.Assets?.map(l=>l.Id)??[]}:r}else return r}catch(n){throw new Error(n)}}}function M(e){return async t=>{try{let r=await N({processId:e.registry?e.registry:T.profileRegistry,action:"Get-Metadata-By-ProfileIds",data:{ProfileIds:t.profileIds},ao:e.ao});return r&&r.length?t.profileIds.map(n=>{let o=r.find(s=>s.ProfileId===n);return{id:o?o.ProfileId:n,username:o?o.Username:null,avatar:o?o.ProfileImage:null,bio:o?o.Description??null:null,lastUpdate:Date.now()}}):[]}catch(r){throw new Error(r)}}}var we=c(u(),1);function oe(e){return async t=>{try{let r=t.profileSrc?t.profileSrc:T.profileSrc,n=await fetch(`${e.arweaveUrl}/${r}`);if(!n.ok)throw new Error("Error fetching the process source code.");let o=await n.text(),a=[{name:"Date-Created",value:new Date().getTime().toString()},{name:"Action",value:"Create-Profile"}];e.logging&&console.log("Spawning profile process...");let l=await e.ao.spawn({module:t.module?t.module:T.module,scheduler:t.scheduler?t.scheduler:T.scheduler,signer:e.signer,tags:a,data:JSON.stringify(S(t.data))});e.logging&&console.log("Process Id -",l),e.logging&&console.log("Fetching profile process...");let h=null,y=0;for(;!h;){await new Promise(J=>setTimeout(J,2e3));let g=await k({gateway:e.graphqlUrl,ids:[l],tagFilters:null,owners:null,cursor:null});if(g&&g.data.length)e.logging&&console.log("Fetched transaction -",g.data[0].node.id),h=g.data[0].node.id;else if(e.logging&&console.log("Transaction not found -",l),y++,y>=200)throw new Error("Profile not found, please try again")}e.logging&&console.log("Sending source eval...");let P=await e.ao.message({process:l,signer:e.signer,tags:[{name:"Action",value:"Eval"}],data:o});e.logging&&console.log(P);let I=await e.ao.result({message:P,process:l});return e.logging&&console.log(I),await new Promise(g=>setTimeout(g,1e3)),e.logging&&console.log("Updating profile data..."),await U({processId:l,action:"Update-Profile",tags:null,data:JSON.stringify(S(t.data)),ao:e.ao,signer:e.signer}),l}catch(r){throw new Error(r)}}}function se(e){return async t=>(e.logging&&console.log(`Updating Profile ${t.profileId}`),(await U({processId:t.profileId,action:"Update-Profile",tags:[{name:"ProfileProcess",value:t.profileId}],data:JSON.stringify(S(t.data)),ao:e.ao,signer:e.signer}))["Profile-Success"]?.id)}var ie=e=>({create:oe({ao:e.ao,signer:e.signer,arweaveUrl:e?.arweaveUrl?e.arweaveUrl:$,graphqlUrl:e?.graphqlUrl?e.graphqlUrl:A.goldsky,logging:e.logging}),update:se({ao:e.ao,signer:e.signer,logging:e.logging}),getById:F({ao:e.ao,registry:e.registry}),getByWallet:W({ao:e.ao,registry:e.registry}),getRegistryProfiles:M({ao:e.ao,registry:e.registry})});0&&(module.exports={init});
//# sourceMappingURL=index.cjs.map
